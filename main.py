from fastapi import FastAPI, Request
from fastapi.templating import Jinja2Templates
import uvicorn
from fastapi import FastAPI, Depends, HTTPException, status
from fastapi.security import OAuth2PasswordRequestForm
from sqlalchemy.ext.asyncio import AsyncSession
import models
import schemas
import crud
import auth
from database import engine, get_db
import aiosqlite
import python_multipart

app = FastAPI()



templates = Jinja2Templates(directory="templates")


@app.get("/")
def home(request: Request):
    guitars = [
        {"name": "Стара гітара 1", "price": 1000, "image": "https://thumbs.dreamstime.com/b/%D0%BE%D0%B1%D0%BE%D0%B8-%D1%81%D1%82%D0%B0%D1%80%D0%BE%D0%B9-%D0%B3%D0%B8%D1%82%D0%B0%D1%80%D1%8B-%D1%82%D0%B5%D1%81%D0%BD%D1%8B%D0%B5-upguitar-%D0%B4%D1%80%D1%83%D0%B3%D0%BE%D0%B5-%D1%84%D0%BE%D1%82%D0%BE-%D1%83%D0%B3%D0%BB%D0%B0-%D1%81%D1%82%D0%B0%D1%80%D1%8B%D0%B9-%D0%BA%D0%BE%D0%BD%D0%B5%D1%86-%D0%B2%D0%B2%D0%B5%D1%80%D1%85-186510246.jpg"},
        {"name": "Стара гітара 2", "price": 1250, "image": "https://i.ytimg.com/vi/NAtIMDH5YJY/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLCv4DFs61pipISYh3OEbrFPMFRdqQ"},
        {"name": "Айфон 12", "price": 15000, "image": "https://jobstore.com.ua/content/images/8/900x900l85nn0/copy_b-u-iphone-12-pro-256gb-pacific-blue-copy_01894-56974681704342.jpg"},
        {"name": "Велосипед", "price": 7000, "image": "https://interbike.com.ua/wa-data/public/shop/products/75/04/10475/images/33318/33318.970.jpg"},
        {"name": "iPad 11", "price": 18000, "image": "https://scdn.comfy.ua/89fc351a-22e7-41ee-8321-f8a9356ca351/https://cdn.comfy.ua/media/catalog/product/i/p/ipad-2022-hero-blue-wifi-select_1__3.jpg/w_600"},
        {"name": "Дом", "price": 800000, "image": "data:image/jpeg;base64,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"},
    ]
    return templates.TemplateResponse("index.html", {"request": request, "guitars": guitars})

@app.get("/add")
def add_item(request: Request):
    return templates.TemplateResponse("add-item.html", {"request": request})

@app.get("/item")
def item_detail(request: Request):
    return templates.TemplateResponse("item.html", {"request": request})



@app.on_event("startup")
async def on_startup():
    async with engine.begin() as conn:
        await conn.run_sync(models.Base.metadata.create_all)

@app.post("/register", response_model=schemas.UserRead, status_code=status.HTTP_201_CREATED)
async def register(user: schemas.UserCreate, db: AsyncSession = Depends(get_db)):
    db_user = await crud.get_user_by_email(db, user.email)
    if db_user:
        raise HTTPException(status_code=400, detail="Email вже зареєстрований")
    created_user = await crud.create_user(db, user.email, user.name, user.password)
    return created_user

@app.post("/token")
async def login(form_data: OAuth2PasswordRequestForm = Depends(), db: AsyncSession = Depends(get_db)):
    user = await auth.authenticate_user(db, form_data.username, form_data.password)
    if not user:
        raise HTTPException(status_code=400, detail="Невірні облікові дані")

    return {"access_token": user.email, "token_type": "bearer"}

@app.get("/users/me", response_model=schemas.UserRead)
async def read_users_me(current_user: models.User = Depends(auth.get_current_user)):
    return current_user

if __name__ == "__main__":
    uvicorn.run("main:app", port=8002, reload=True)